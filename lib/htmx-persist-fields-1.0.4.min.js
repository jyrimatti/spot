(function(){function t(e){if(e=="queryStorage"||e=="fragmentStorage"||e=="cookieStorage"||e=="httpStorage"){return true}let t;try{t=window[e];const n="__storage_test__";t.setItem(n,n);t.removeItem(n);return true}catch(e){return e instanceof DOMException&&(e.code===22||e.code===1014||e.name==="QuotaExceededError"||e.name==="NS_ERROR_DOM_QUOTA_REACHED")&&t&&t.length!==0}}function l(e){return(e===undefined?"":Array.isArray(e)?e.join(""):e.toString()).replaceAll("%2C",",").replaceAll("%3A",":").replaceAll("%2F","/")}function s(e,t,n){return n.indexOf(e)===t}function a(e){return e.type==="checkbox"||e.type==="radio"}function o(e,t){let n=t==e.getAttribute("name")||t==e.getAttribute("persist-fields-name")?[e]:[];return n.concat([...e.querySelectorAll('[name="'+t+'"'),...e.querySelectorAll('[persist-fields-name="'+t+'"]')])}function d(e){return a(e)?[e.checked]:e.tagName==="SELECT"?[...e.selectedOptions].map(e=>e.value):e.tagName==="INPUT"||e.tagName==="TEXTAREA"?[e.value]:[e.innerText]}function e(e){return a(e)?[e.defaultChecked]:e.tagName==="SELECT"?[...e.options].filter(e=>e.defaultSelected).map(e=>e.value):e.tagName==="INPUT"||e.tagName==="TEXTAREA"?[e.defaultValue]:[e.innerText]}function c(e,t,n){let i=o(e,t).filter(e=>!e.closest(":disabled"));let r=i.filter(a).filter(e=>n(e)[0]).map(e=>e.value).join(",");let l=i.filter(e=>!a(e));while(l.length>0&&(JSON.stringify(n(l[l.length-1]))==='[""]'||l[l.length-1].hasAttribute("readonly")&&!l[l.length-1].hasAttribute("required"))){l.splice(-1,1)}return[r].filter(e=>e!="").concat(l.flatMap(n))}function u(e){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName)&&e.hasAttribute("name")||e.hasAttribute("persist-fields-name")){return[e]}else{var n=[];e.querySelectorAll("input[name], textarea[name], select[name], [persist-fields-name]").forEach(t=>{q.withExtensions(t,function(e){if(e._ext_persist_fields){n.push(t)}})});return n}}function i(n,e,i){if(typeof n==="number"){var t=(i.trim().length==0?[]:i.split(e)).map(decodeURIComponent);return n<t.length?[t[n]]:undefined}else if(typeof n==="string"){let e=new URLSearchParams(i);let t=e.has(n)?e.getAll(n):undefined;return Array.isArray(t)&&t.length==1&&t[0]===""?[]:t}else{throw new Error("Invalid storageKey")}}function g(e,t,n){if(e=="query"){n(i(t,"&",window.location.search.substring(1)))}else if(e=="fragment"){n(i(t,"#",window.location.hash.substring(1)))}else if(e=="cookie"){let e=document.cookie.split("; ").filter(e=>e.length>0).map(e=>{let t=e.split("=");let n={};n[t[0]]=t[1]===undefined?undefined:t[1].split(",").map(decodeURIComponent);return n}).reduce((e,t)=>Object.assign(e,t),{});n(t?e[t]?e[t]:undefined:document.cookie.length==0?undefined:e)}else if(e=="session"){n(JSON.parse(sessionStorage.getItem(t))||{})}else if(e=="local"){n(JSON.parse(localStorage.getItem(t))||{})}else if(e=="http"){let e=new XMLHttpRequest;e.open("GET",t);e.onload=()=>{n(JSON.parse(e.responseText))};e.send()}}function r(n,e,i,r){if(typeof n==="number"){const t=i.substring(1).split(e);while(t.length<=n){t.push("")}t[n]=l(r);return t.join(e).replace(new RegExp(e+"+$"),"")}else{let t=new URLSearchParams(i.substring(1));t.delete(n);if(r===undefined){}else if(r.length==0){t.append(n,"")}else{r.forEach(e=>t.append(n,l(e)))}return l(t)}}function h(e,t,n,i){if(e==="query"){let e=r(n,"&",window.location.search,t);if(e!==window.location.search.substring(1)){history.replaceState(null,null,window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+e+window.location.hash)}}else if(e==="fragment"){let e=r(n,"#",window.location.hash,t);if(e!==window.location.hash.substring(1)){history.replaceState(null,null,window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search+"#"+e)}}else if(e==="cookie"){if(t){document.cookie=n+"="+t.map(encodeURIComponent).join(",")+";"+i}else{document.cookie=n+"=;max-age=0"}}else if(e==="session"){if(t===undefined){sessionStorage.removeItem(n)}else{sessionStorage.setItem(n,JSON.stringify(t))}}else if(e==="local"){if(t===undefined){localStorage.removeItem(n)}else{localStorage.setItem(n,JSON.stringify(t))}}else if(e==="http"){let e=new XMLHttpRequest;if(t===undefined){e.open("DELETE",n);e.send()}else{e.open("PUT",n);e.send(JSON.stringify(t))}}}function p(e,t){if(t){if(t.delete){t.delete(e)}else if(t[e]!==undefined){delete t[e]}}return t}function f(e,t,n){g(e,n,()=>{if(t){t.querySelectorAll("[data-persist-fields-initialized]").forEach(e=>{if(a(e)){e.checked=e.getAttribute("data-persist-fields-initialized")==="true"}else{e.value=e.getAttribute("data-persist-fields-initialized")}})}h(e,undefined,n)})}function n(e,i,t,r){if(r!==undefined){if(a(i)){i.checked=r.flatMap(e=>e.split(",")).includes(i.value)}else{let n=o(e,t);if(n.length===1){if(i.tagName==="INPUT"||i.tagName==="TEXTAREA"){i.value=r.length==0?"":r.join(",")}else if(i.tagName==="SELECT"){[...i.options].forEach(e=>e.selected=r.flatMap(e=>e.split(",")).includes(e.value))}else{i.innerText=r.length==0?"":r.join("")}}else{let e=n.indexOf(i);let t=N(n,r,e);if(t!==undefined){if(i.tagName==="INPUT"||i.tagName==="TEXTAREA"){i.value=t}else if(i.tagName==="SELECT"){[...i.options].forEach(e=>e.selected=t===e.value)}else{i.innerText=t}}}}}}function m(t,n){if(n.hasAttribute("readonly")){if(t.startsWith(n.getAttribute("value"))){let e=n.getAttribute("value");return[e,t.substring(e.length)]}}return undefined}function A(t,n){if(n.hasAttribute("minlength")&&n.getAttribute("minlength")===n.getAttribute("maxlength")){let e=t.substring(0,parseInt(n.getAttribute("minlength")));return[e,t.substring(e.length)]}return undefined}function b(n,i){if(i.hasAttribute("pattern")){let e=i.getAttribute("pattern");let t=n.match(e.startsWith("^")?e:"^"+e);if(t!==null){let e=t.length>1?t[1]:t[0];return[e,n.substring(e.length)]}}return undefined}function E(n,e){if(e.getAttribute("type")==="datetime-local"){let t=n.match("^[0-9]{1,4}-[0-9]{2}-[0-9]{2}[T ][0-9]{2}:[0-9]{2}");if(t!==null){let e=t[0];return[e,n.substring(e.length)]}}return undefined}function w(n,e){if(e.getAttribute("type")==="date"){let t=n.match("^[0-9]{1,4}-[0-9]{2}-[0-9]{2}");if(t!==null){let e=t[0];return[e,n.substring(e.length)]}}return undefined}function S(n,e){if(e.getAttribute("type")==="time"){let t=n.match("^[0-9]{2}:[0-9]{2}(:[0-9]{2})?");if(t!==null){let e=t[0];return[e,n.substring(e.length)]}}return undefined}function y(t,n){if(n.tagName==="SELECT"){let e=[...n.options].map(e=>e.value).filter(e=>e!=="").filter(e=>t.startsWith(e)).sort((e,t)=>t.length-e.length).find(e=>true);if(e){return[e,t.substring(e.length)]}}return undefined}function T(e,t){return[e,""]}function x(n,i){for(let t in C){let e=C[t](n,i);if(e!==undefined){return e}}return undefined}function N(n,i,r){if(i.length==0){return""}else if(i.length>1){return i[r]}else{let[e,t]=n.slice(0,r+1).reduce(([e,t],n)=>x(t,n),[undefined,i[0]]);return e}}function v(e){return e.getAttribute("name")||e.getAttribute("persist-fields-name")}function I(e,t,n){return e==="cookie"?t:e==="http"?n:n!==undefined?n:t}function O(i,r,l,s){let a=v(l);let o=I(r,a,s);let u=r==="local"||r==="session"||r==="http";let f=c(i,a,e);g(r,o,e=>{n(i,l,a,u?e[a]:e)});window.addEventListener("htmx:persistFieldsSave",e=>{if(e.detail.scope!==i){g(r,o,e=>{n(i,l,a,u?e[a]:e)})}});l.setAttribute("data-persist-fields-initialized",e(l).join(","));htmx.process(l);if(!l.hasAttribute("readonly")){q.getTriggerSpecs(l).forEach(e=>{let t=q.getInternalData(l);q.addTriggerHandler(l,e,t,(e,t)=>{if(htmx.closest(e,htmx.config.disableSelector)){return}let n=c(i,a,d);g(r,o,e=>{let t=u?p(a,e):undefined;if(JSON.stringify(n)!=JSON.stringify(f)||l.required){if(t&&!Array.isArray(t)){t[a]=n}else{t=n}}h(r,t,o,s);window.dispatchEvent(new CustomEvent("htmx:persistFieldsSave",{detail:{scope:i,storage:r}}))})})})}}let R=["session","local","query","fragment","cookie","http"];let _=R.filter(e=>t(e+"Storage"));let k=_.map(e=>"[persist-fields-"+e+"]").join(",");var q;var C;htmx.defineExtension("persist-fields",{_ext_persist_fields:true,init:function(e){q=e;C=[m,A,b,E,w,S,y,T]},onEvent:function(e,t){if(e==="htmx:persistFieldsClear"){let l=htmx.closest(t.detail.elt,k);if(l){let i=_.find(e=>l.hasAttribute("persist-fields-"+e));let r=l.getAttribute("persist-fields-"+i);u(l).forEach(e=>{let t=v(e);if(r==="indexed"){let e=u(l).map(v).filter(s);r=e.indexOf(t)}else if(r===""||i==="query"||i==="fragment"){r=undefined}let n=I(i,t,r);f(i,l,n)})}}else if(e==="htmx:afterProcessNode"){u(t.detail.elt).filter(e=>!e.hasAttribute("data-persist-fields-initialized")).forEach(n=>{let i=htmx.closest(n,k);if(i){let e=_.find(e=>i.hasAttribute("persist-fields-"+e));let t=i.getAttribute("persist-fields-"+e);if(t==="indexed"){let e=u(i).map(v).filter(s);t=e.indexOf(v(n))}else if(t===""||e==="query"||e==="fragment"){t=undefined}O(i,e,n,t)}})}}})})();